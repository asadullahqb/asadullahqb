name: Lion Agent

on:
  schedule:
    - cron: '0 9 * * 1'      # Weekly: Monday at 9:00 AM UTC
    - cron: '0 0 1 */3 *'    # Quarterly: 1st day of every 3rd month
  workflow_dispatch:
    inputs:
      mode:
        description: 'Agent Mode'
        required: true
        default: 'weekly'
        type: choice
        options:
          - weekly
          - update

jobs:
  run-agent:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install dependencies
        run: |
          pip install -r requirements.txt

      - name: Determine Mode
        id: mode
        run: |
          if [ "${{ github.event_name }}" == "workflow_dispatch" ]; then
            echo "MODE=${{ inputs.mode }}" >> $GITHUB_ENV
          else
            # Default to weekly
            MODE="weekly"
            
            # Check if today is the 1st of the month (Quarterly trigger)
            if [ "$(date +%d)" -eq "01" ]; then
              MODE="update"
            fi
            
            echo "MODE=$MODE" >> $GITHUB_ENV
          fi

      - name: Run Lion Agent
        env:
          TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "Running in $MODE mode"
          python agent.py ${{ env.MODE }}
